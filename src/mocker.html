<html>
<body>
  <h2>Response editor</h2>
  <form id="add-form">
    <label>URL (exact match): <input name="url" required></label><br>
    <label>Status: <input name="status" type="number" value="200"></label><br>
    <label>Headers (JSON): <textarea name="headers">{ "Content-Type": "application/json" }</textarea></label><br>
    <label>Body: <textarea name="body">{ "message": "Hello from iframe" }</textarea></label><br>
    <button type="submit">Add/Update Response</button>
  </form>

  <h3>Saved Responses</h3>
  <table id="responses-table">
    <thead>
      <tr><th>URL</th><th>Status</th><th>Headers</th><th>Body</th><th>Actions</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <h3>Request Log</h3>
  <ul id="log" style="max-height: 200px; overflow-y: auto; background: #f9f9f9; padding: 10px; border: 1px solid #ccc; border-radius: 4px;"></ul>

<style>
  /* General page styling */
body {
  font-family: system-ui, sans-serif;
  margin: 20px;
  line-height: 1.5;
  background: #fafafa;
  color: #333;
}

/* Headings */
h2, h3 {
  margin-top: 1.5em;
  margin-bottom: 0.5em;
  font-weight: 600;
}

/* Form styling */
form#add-form {
  background: #fff;
  padding: 16px;
  border-radius: 6px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  max-width: 600px;
  margin-bottom: 2em;
}

form#add-form label {
  display: block;
  margin-bottom: 12px;
  font-weight: 500;
}

form#add-form input,
form#add-form textarea {
  display: block;
  width: 100%;
  box-sizing: border-box;
  padding: 6px 8px;
  margin-top: 4px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-family: monospace;
  font-size: 0.95em;
}

form#add-form textarea {
  min-height: 60px;
  resize: vertical;
}

form#add-form button {
  margin-top: 12px;
  padding: 8px 16px;
  font-size: 1em;
  border: none;
  border-radius: 4px;
  background: #007bff;
  color: white;
  cursor: pointer;
  transition: background 0.2s ease;
}

form#add-form button:hover {
  background: #0056b3;
}

/* Table styling */
#responses-table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 2em;
  background: #fff;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}

#responses-table th,
#responses-table td {
  border: 1px solid #ddd;
  padding: 8px 12px;
  text-align: left;
  font-family: monospace;
  font-size: 0.95em;
}

#responses-table th {
  background: #f0f0f0;
  font-weight: 600;
}

#responses-table tbody tr:nth-child(even) {
  background: #f9f9f9;
}

/* Log styling */
#log {
  max-height: 200px;
  overflow-y: auto;
  background: #f9f9f9;
  padding: 10px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-family: monospace;
  font-size: 0.9em;
}

/* Optional: table action buttons */
#responses-table button {
  padding: 4px 8px;
  border: none;
  border-radius: 3px;
  background: #dc3545;
  color: white;
  cursor: pointer;
  font-size: 0.85em;
}

#responses-table button:hover {
  background: #b02a37;
}

</style>

  <script>
    const responses = new Map();

    function renderTable() {
      const tbody = document.querySelector("#responses-table tbody");
      tbody.innerHTML = "";
      for (const [url, res] of responses.entries()) {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${url}</td>
          <td>${res.status}</td>
          <td><pre>${JSON.stringify(res.headers)}</pre></td>
          <td><pre>${res.body}</pre></td>
          <td><button data-url="${url}">Delete</button></td>
        `;
        tbody.appendChild(tr);
      }
    }

    document.getElementById("add-form").addEventListener("submit", e => {
      e.preventDefault();
      const form = e.target;
      const url = form.url.value;
      try {
        const status = parseInt(form.status.value);
        const headers = JSON.parse(form.headers.value);
        const body = form.body.value;

        responses.set(url, { status, headers, body });
        renderTable();
        form.reset();
      } catch (err) {
        alert("Invalid input: " + err.message);
      }
    });

    document.querySelector("#responses-table").addEventListener("click", (e) => {
      if (e.target.tagName === "BUTTON") {
        responses.delete(e.target.dataset.url);
        renderTable();
      }
    });

    window.addEventListener("message", (event) => {
      const data = event.data;
      if (!data) return;

      const match = responses.get(data.url);
      if (match) {
        logRequest(data.url, true, `responded with status ${match.status}`);
        event.source.postMessage({
          id: data.id,
          status: match.status,
          statusText: "OK",
          headers: match.headers,
          body: match.body
        }, "*");
      } else {
        logRequest(data.url, false, "no mock response found");
        event.source.postMessage({
          id: data.id,
          error: 'no mock'
        }, "*");
      }
    });

    
    function logRequest(url, success, message) {
      const log = document.getElementById('log');
      const li = document.createElement('li');
      li.textContent = `${success ? 'pass' : 'fail'} ${url} â€” ${message}`;
      log.prepend(li);
    }
    
    renderTable();
  </script>
</body>
</html>
